{% extends 'base.html' %}
{% block title %}Profile | Hoosier Hub{% endblock %}

{% block content %}
<section class="container py-5">
  <div class="row g-4">
    <div class="col-lg-4">
      <div class="card shadow-sm border-0">
        <div class="card-body text-center">
          <img src="{{ current_user.profile_image }}" alt="Profile image" class="rounded-circle mb-3"
            style="width: 110px; height: 110px; object-fit: cover;">
          <h4 class="fw-bold mb-1">{{ current_user.name }}</h4>
          <p class="text-muted mb-3">{{ current_user.email }}</p>
          <span class="badge bg-primary-subtle text-primary me-2 text-uppercase">{{ current_user.role }}</span>
          <span
            class="badge {{ 'bg-success-subtle text-success' if current_user.status == 'active' else 'bg-warning text-dark' }}">
            {{ current_user.status|capitalize }}
          </span>
          <hr>
          <div class="text-start small">
            <p class="mb-2"><i class="fas fa-building me-2 text-danger"></i>{{ current_user.department or 'Department not set' }}
            </p>
            <p class="mb-0">
              <i class="fas fa-calendar me-2 text-danger"></i>Member since
              {{ current_user.created_at.strftime('%b %d, %Y') }}
            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-8">
      <div class="card shadow-sm border-0 mb-4">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
              <h5 class="fw-bold mb-0">Profile Details</h5>
              <small class="text-muted">Update your basic information.</small>
            </div>
          </div>
          <form method="POST" action="{{ url_for('auth.profile') }}">
            <input type="hidden" name="action" value="update_profile">
            <div class="mb-3">
              <label class="form-label">Full Name</label>
              <input type="text" name="name" class="form-control" value="{{ current_user.name }}" required>
            </div>
            <div class="mb-3">
              <label class="form-label">Department</label>
              <input type="text" name="department" class="form-control"
                value="{{ current_user.department or '' }}" placeholder="e.g., Informatics">
            </div>
            <div class="mb-3">
              <label class="form-label">Profile Image URL</label>
              <input type="url" name="profile_image" class="form-control"
                value="{{ current_user.profile_image or '' }}" placeholder="https://example.com/me.jpg">
              <small class="text-muted">Leaving this blank will generate an avatar from your name.</small>
            </div>
            <div class="d-flex justify-content-end">
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save me-2"></i>Save Changes
              </button>
            </div>
          </form>
        </div>
      </div>

      <div class="card shadow-sm border-0">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
              <h5 class="fw-bold mb-0">Security</h5>
              <small class="text-muted">Change your account password.</small>
            </div>
          </div>
          <form method="POST" action="{{ url_for('auth.profile') }}">
            <input type="hidden" name="action" value="change_password">
            <div class="mb-3">
              <label class="form-label">Current Password</label>
              <input type="password" name="current_password" class="form-control" required>
            </div>
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">New Password</label>
                  <input type="password" name="new_password" class="form-control" minlength="8" required>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">Confirm New Password</label>
                  <input type="password" name="confirm_password" class="form-control" minlength="8" required>
                </div>
              </div>
            </div>
            <div class="alert alert-warning small">
              <i class="fas fa-info-circle me-2"></i>Password must be at least 8 characters. Choose a strong mix of
              letters, numbers, and symbols.
            </div>
            <div class="d-flex justify-content-end">
              <button type="submit" class="btn btn-outline-danger">
                <i class="fas fa-key me-2"></i>Update Password
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}

