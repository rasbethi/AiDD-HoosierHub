{% extends 'base.html' %}
{% block title %}Admin Inbox | Hoosier Hub{% endblock %}
{% block content %}

<div class="container-fluid py-5">
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-3 mb-4">
    <div>
      <h1 class="admin-title mb-1"><i class="fas fa-inbox me-2 text-danger"></i>Admin Inbox</h1>
      <p class="text-muted mb-0">Only “book for me” requests appear here. Restricted approvals stay with resource owners.</p>
    </div>
    <div class="d-flex gap-2">
      <a href="{{ url_for('admin.list_requests') }}" class="btn btn-outline-secondary">
        <i class="fas fa-list me-2"></i>Legacy View
      </a>
      <a href="{{ url_for('admin.dashboard') }}" class="btn btn-outline-secondary">
        <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
      </a>
    </div>
  </div>

  <div class="card border-0 shadow-sm mb-4">
    <div class="card-body">
      <form class="row g-3 align-items-end" method="GET" action="{{ url_for('admin.admin_inbox') }}">
        <div class="col-md-4">
          <label class="form-label fw-semibold">Status</label>
          <select name="status" class="form-select">
            <option value="">All statuses</option>
            {% for status in valid_statuses %}
            <option value="{{ status }}" {% if status==status_filter %}selected{% endif %}>{{ status|capitalize }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-8 d-flex gap-2">
          <button class="btn btn-danger flex-grow-1"><i class="fas fa-filter me-2"></i>Apply Filters</button>
          <a href="{{ url_for('admin.admin_inbox') }}" class="btn btn-outline-secondary">Reset</a>
        </div>
      </form>
    </div>
  </div>

  {% if requests %}
  <div class="card border-0 shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>Requester</th>
              <th>Resource</th>
              <th>Requested Window</th>
              <th>Status</th>
              <th>Submitted</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for req in requests %}
            <tr class="{% if req.status == 'pending' %}table-warning{% endif %}">
              <td class="fw-semibold">#{{ req.id }}</td>
              <td>
                <div class="fw-semibold">{{ req.requester.name }}</div>
                <small class="text-muted">{{ req.requester.email }}</small>
              </td>
              <td>
                <div class="fw-semibold">{{ req.resource.title }}</div>
                <small class="text-muted">{{ req.resource.location }}</small>
              </td>
              <td>
                <div class="fw-semibold">{{ req.start_time.strftime('%b %d, %Y %I:%M %p') }}</div>
                <small class="text-muted">to {{ req.end_time.strftime('%b %d, %Y %I:%M %p') }}</small>
              </td>
              <td>
                <span class="badge {% if req.status == 'pending' %}bg-warning text-dark{% elif req.status == 'approved' %}bg-success{% elif req.status == 'denied' %}bg-danger{% else %}bg-secondary{% endif %}">
                  {{ req.status|upper }}
                </span>
              </td>
              <td>
                <div class="fw-semibold">{{ req.created_at.strftime('%b %d, %Y') }}</div>
                <small class="text-muted">{{ req.created_at.strftime('%I:%M %p') }}</small>
              </td>
              <td class="text-end">
                <a href="{{ url_for('admin.view_request', request_id=req.id) }}" class="btn btn-outline-danger btn-sm">
                  <i class="fas fa-eye me-1"></i>View
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  {% else %}
  <div class="text-center py-5">
    <i class="fas fa-check-circle fa-2x text-success mb-3"></i>
    <p class="text-muted mb-0">Nothing to review. Every request is handled!</p>
  </div>
  {% endif %}
</div>

{% endblock %}

